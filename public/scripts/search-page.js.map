{"version":3,"names":[],"mappings":"","sources":["search-page.js"],"sourcesContent":["var monthsTH = ['ม.ค.','ก.พ.','มี.ค','เม.ย.','พ.ค.','มิ.ย','ก.ค.','ส.ค.','ก.ย.','ต.ค.','พ.ย.','ธ.ค.'];\nvar weekdaysTH = ['อา.','จ.','อ.','พ.','พฤ.','ศ.','ส.'];\nvar monthsEN = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\nvar weekdaysEN = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];\n\nconst apiURL = \"https://api.space.itforge.io/graphql\";\n\nfunction buildTagQuery(tags, type) {\n\tvar temp = \"\";\n\tif (type) temp += (type + \",\");\n\tfor (var i = 0; i < tags.length; i++) {\n\t\ttemp += tags[i];\n\t\tif (i < tags.length-1) temp += \",\";\n\t}\n\treturn temp;\n}\n\nfunction buildSearchQuery(room, faculty, tags, capacity) {\n\tvar temp = \"\";\n\tif (room) temp += (room + \" \");\n\tif (faculty) temp += (\"department:\" + faculty + \" \");\n\tif (tags) temp += (\"tags:\" + tags + \" \");\n\tif (capacity) temp += (\"capacity:\" + capacity);\n\treturn temp;\n}\n\nVue.component(\"result-card\", {\n\tprops: [\"slug\", \"name\", \"dept\", \"deptSlug\", \"capacity\", \"amenities\"],\n\ttemplate: \"#result-card\"\n});\n\nVue.component(\"spinner\", {\n\ttemplate: `<div class=\"spinner\" style=\"margin-top: 4em\"></div>`\n});\n\nvar app = new Vue({\n\tel: \"#app\",\n\tdata: {\n\t\ts_room: \"\",\n\t\ts_date: new Date(),\n\t\ts_date_raw: \"\",\n\t\ts_faculty: \"\",\n\t\ts_tags: [],\n\t\ts_type: \"\",\n\t\ts_capacity: \"\",\n\t\tfirstSearch: true,\n\t\tsearchResults: [],\n\t\tloading: false\n\t},\n\tmethods: {\n\t\tdoSearch: function() {\n\t\t\tthis.searchResults.length = 0;\n\t\t\tthis.s_tags.length = 0;\n\t\t\tthis.loading = true;\n\t\t\tvar tagInput = document.getElementsByName(\"s_tags\");\n\t\t\tfor (var i = 0; i < tagInput.length; i++) if (tagInput[i].checked) this.s_tags.push(tagInput[i].value);\n\t\t\tvar tagQuery = buildTagQuery(this.s_tags, this.s_type);\n\t\t\tvar searchQuery = buildSearchQuery(this.s_room, this.s_faculty, tagQuery, this.s_capacity);\n\t\t\tif (this.firstSearch) {\n\t\t\t\tdocument.getElementById(\"page-title\").remove();\n\t\t\t\tdocument.getElementById(\"search-house\").remove();\n\t\t\t\tthis.firstSearch = false;\n\t\t\t}\n\t\t\taxios(apiURL, {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tdata: {\n\t\t\t\t\tquery: `\n\t\t\t\t\t\tquery {\n\t\t\t\t\t\t\tsearch(query: \"${searchQuery}\") {\n\t\t\t\t\t\t\t\tid name fullName capacity\n\t\t\t\t\t\t\t\tdepartment {name fullThaiName}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t`\n\t\t\t\t}\n\t\t\t})\n\t\t\t\t.then(function(result) {\n\t\t\t\t\tapp.searchResults = result.data.data.search;\n\t\t\t\t\tapp.loading = false;\n\t\t\t\t})\n\t\t\t\t.catch(function(err) {\n\t\t\t\t\tconsole.log(err);\n\t\t\t\t\tapp.loading = false;\n\t\t\t\t});\n\t\t}\n\t}\n});\n\nfunction setRawDate(date) {\n\t// create a raw date for sending to the API (eg. 2018-04-14)\n\tvar m = date.getMonth() + 1;\n\tvar d = date.getDate();\n\treturn (\n\t\tdate.getFullYear() + \"-\" + (m < 10 ? \"0\" + m : m) + \"-\" + (d < 10 ? \"0\" + d : d)\n\t);\n}\n\nconst today = new Date();\n\nvar picker = new Pikaday({\n\tfield: document.getElementById(\"datepicker\"),\n\ti18n: {\n\t\tpreviousMonth: 'เดือนที่แล้ว',\n\t\tnextMonth: 'เดือนหน้า',\n\t\tmonths: ['มกราคม','กุมภาพันธ์','มีนาคม','เมษายน','พฤษภาคม','มิถุนายน','กรกฎาคม','สิงหาคม','กันยายน','ตุลาคม','พฤศจิกายน','ธันวาคม'],\n\t\tweekdays: ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],\n\t\tweekdaysShort: ['อา.','จ.','อ.','พ.','พฤ.','ศ.','ส.']\n\t},\n\tfirstDay: 1,\n\tformat: \"DD-MM-YYYY\",\n\tminDate: today,\n\tmaxDate: new Date(\n\t\ttoday.getFullYear() + 1,\n\t\ttoday.getMonth(),\n\t\ttoday.getDate()\n\t),\n\tyearRange: [today.getFullYear(), today.getFullYear() + 1],\n\tonClose: function() {\n\t\tapp.s_date = document.getElementById(\"datepicker\").value;\n\t\tapp.s_date_raw = setRawDate(picker.getDate());\n\t},\n\ttoString(date) {\n\t\tconst day = date.toString().split(\" \")[2];\n\t\tconst month = date.toString().split(\" \")[1];\n\t\tconst weekday = date.toString().split(\" \")[0];\n\t\tfunction monthsMapper(element) {\n\t\t\treturn element == `${month}`;\n\t\t}\n\t\tfunction weekdaysMapper(element) {\n\t\t\treturn element == `${weekday}`;\n\t\t}\n\t\tapp.s_date = `${weekdaysTH[weekdaysEN.findIndex(weekdaysMapper)]}\\u0020${day}\\u0020${monthsTH[monthsEN.findIndex(monthsMapper)]}`;\n\t\treturn `${weekdaysTH[weekdaysEN.findIndex(weekdaysMapper)]}\\u0020${day}\\u0020${monthsTH[monthsEN.findIndex(monthsMapper)]}`;\n\t}\n});\n\napp.s_date_raw = setRawDate(picker.getDate()); // initial to present\n"],"file":"search-page.js"}